# Rapidbot STRUCTURE REPORT

## 1) Repo tree summary (targeted, depth<=4)

```text
/workspace/Rapidbot
├─ README.md
├─ kill_shadow.bat
├─ run_shadow_mexc_sol_5m.bat
├─ run_shadow_mexc_sol_5m_telegram.bat
├─ run_shadow_spot_btc_usdc.bat
├─ run_shadow_spot_xrp_usdt.bat
├─ scripts/
│  ├─ bt_spot_btc_usdc.py
│  ├─ bt_spot_eth_usdc.py
│  ├─ bt_spot_sol_usdc.py
│  ├─ dl_spot_ohlcv.py
│  ├─ dl_spot_binance.py
│  ├─ dl_spot_btc_usdc.py
│  ├─ dl_spot_eth_usdc.py
│  ├─ dl_spot_sol_usdc.py
│  ├─ dl_spot_btc_usdt.py
│  ├─ solusdt_vwap_bot_spot.py
│  ├─ run_shadow.py
│  ├─ shadow_ws_runner.py
│  ├─ inspect_csv.py
│  ├─ strategies/
│  ├─ paper/
│  └─ tests/
├─ Datasets/
│  ├─ binance_vision_solusdt_5m.py
│  ├─ BTCUSDC/5m/*.csv
│  ├─ ETHUSDC/5m/*.csv
│  ├─ SOLUSDC/5m/*.csv
│  ├─ SOLUSDT/5m/*.csv
│  └─ _cache_binance_vision/*.zip
├─ results/
│  ├─ equity_curve.csv
│  ├─ trades.csv
│  ├─ metrics.json
│  ├─ bt_spot_btc_usdc/<timestamp>/
│  ├─ shadow/
│  └─ Backtest/<named_run>/
├─ logs/
└─ tests/
```

### Required-path check
- `/workspace/Rapidbot/scripts` ✅
- `/workspace/Rapidbot/Datasets` ✅
- `/workspace/Rapidbot/results/Backtest` ✅
- Not found at repo root: `src/`, `rapidbot/`, `bots/`, `strategies/` (root-level), `core/`, `engine/`, `backtest/`, `data/`, `datasets/` (lowercase), `runs/`, `outputs/`, `reports/`, `notebooks/`.

### Top-level files matching request
- `README.md`
- `kill_shadow.bat`
- `run_shadow_mexc_sol_5m.bat`
- `run_shadow_mexc_sol_5m_telegram.bat`
- `run_shadow_spot_btc_usdc.bat`
- `run_shadow_spot_xrp_usdt.bat`

---

## 2) Backtest entrypoints (spot)

> Search terms used: `argparse`, `click`, `typer`, `fire`, `add_argument(`, `@click.command`, `Typer(`, `if __name__ == '__main__'`

### Primary spot backtest entrypoints

| Entrypoint file | How to run | Purpose | Key flags/defaults |
|---|---|---|---|
| `scripts/bt_spot_btc_usdc.py` | `python scripts/bt_spot_btc_usdc.py --bt --csv <path>` (or `python -m scripts.bt_spot_btc_usdc ...`) | BTC/USDC spot long-only backtest wrapper | `--csv` required, `--symbol BTC/USDC`, `--fee_maker 0.0`, `--fee_taker 0.0`, `--slip_bps_entry 2.0`, `--slip_bps_stop 6.0`, `--tp_bidask_half_spread_bps 1.0`, `--risk_per_trade 0.03`, `--start_equity 5000.0`, `--outdir ""` -> auto `results/bt_spot_btc_usdc/<UTCstamp>` |
| `scripts/bt_spot_eth_usdc.py` | `python scripts/bt_spot_eth_usdc.py --bt --csv <path>` (or module form) | ETH/USDC spot long-only wrapper | Same core flags as BTC wrapper; symbol locked to `ETH/USDC`; auto outdir `results/bt_spot_eth_usdc/<UTCstamp>` |
| `scripts/bt_spot_sol_usdc.py` | `python scripts/bt_spot_sol_usdc.py --bt --csv <path>` (or module form) | SOL/USDC spot long-only wrapper | Same core flags; symbol locked to `SOL/USDC`; includes `--rr_min 1.0` (currently not wired into BTConfig in this wrapper); auto outdir `results/bt_spot_sol_usdc/<UTCstamp>` |
| `scripts/solusdt_vwap_bot_spot.py` | `python scripts/solusdt_vwap_bot_spot.py --bt --csv <path>` (or module form) | Main strategy/backtest engine (spot mode) | Core: `--bt`, `--csv`, `--outdir ./results`, `--equity 1000.0`, `--risk_per_trade 0.03`, `--fee_taker 0.0`, `--fee_maker 0.0`, `--slip_model fixed`, `--slip_bps 0.5`, `--slip_bps_entry/stop/tp` overrides, TP spread + daily DD + max-stops controls |

### Notes on CLI-help extraction
- `python <entrypoint> --help` could not be executed in this environment because `pandas` is not installed, so flags were extracted from source definitions directly.

---

## 3) Dataset conventions (CSV/parquet loaders, paths, schema)

### Where data is loaded
- Backtests load CSV via `load_ohlcv_csv()` in `scripts/solusdt_vwap_bot_spot.py`.
- Downloaders write CSV with schema `ts,open,high,low,close,volume` in:
  - `scripts/dl_spot_ohlcv.py`
  - `scripts/dl_spot_binance.py`
  - `Datasets/binance_vision_solusdt_5m.py`

### Expected CSV columns and timestamp handling
- Required columns: `ts, open, high, low, close, volume`.
- Timestamp parse behavior:
  - Numeric `ts` auto-detected as seconds / milliseconds / microseconds by magnitude.
  - String timestamps parsed via `pd.to_datetime(..., utc=True)`.
  - Rows with invalid timestamps dropped.
  - Duplicate timestamps deduped (keep last), sorted ascending.
- Downloader timestamp normalization output format: `YYYY-MM-DD HH:MM:SS+00:00` (UTC).

### Default dataset directories and naming patterns
- Common local pattern in repo:
  - `Datasets/<SYMBOL>/<TF>/<SYMBOL>_<TF>_full.csv`
  - Examples present: `Datasets/BTCUSDC/5m/BTCUSDC_5m_full.csv`, `Datasets/ETHUSDC/5m/ETHUSDC_5m_fixed.csv`, `Datasets/SOLUSDC/5m/SOLUSDC_5m_fixed.csv`.
- Binance-specific downloader default path:
  - `Datasets/BINANCE/<SYMBOL>/<TF>/<SYMBOL>_<TF>_full.csv`
- Binance Vision script examples use lowercase `datasets/` in defaults/docstrings, but repo currently stores under uppercase `Datasets/`.

### Downloader scripts (Binance spot)
- `scripts/dl_spot_binance.py`: Binance spot klines (`/api/v3/klines`), configurable `--symbol --timeframe --start --end --out`.
- `scripts/dl_spot_ohlcv.py`: generic spot downloader for `mexc` or `binance`, writes normalized OHLCV CSV.
- Convenience wrappers:
  - `scripts/dl_spot_btc_usdc.py` (MEXC BTC/USDC)
  - `scripts/dl_spot_eth_usdc.py` (MEXC ETH/USDC)
  - `scripts/dl_spot_sol_usdc.py` (MEXC SOL/USDC)
  - `scripts/dl_spot_btc_usdt.py` (uses `exchange="binance"`, output filename currently `BTCUSDT_5m_full.csv` under `Datasets/BTCUSDC/5m/`)
- Additional public-data downloader:
  - `Datasets/binance_vision_solusdt_5m.py` supports `--asset spot` and writes CSV dataset plus optional cached ZIPs.

---

## 4) Output / run artifacts

### Backtest artifacts
- `scripts/bt_spot_*` wrappers write:
  - `<outdir>/trades.csv`
  - `<outdir>/equity_curve.csv`
- `scripts/solusdt_vwap_bot_spot.py --bt` writes:
  - `<outdir>/trades.csv`
  - `<outdir>/equity_curve.csv`
  - `<outdir>/metrics.json`

### Existing run/output locations in repo
- `results/bt_spot_btc_usdc/<YYYYMMDD_HHMMSS>/` (timestamped runs).
- `results/Backtest/<named_run>/` (manual/legacy named runs).
- Root `results/` also contains `equity_curve.csv`, `trades.csv`, `metrics.json` from direct runs.
- Shadow/live-related outputs (not BT wrappers):
  - `results/shadow/shadow_events.jsonl`
  - `results/shadow/shadow_candles.csv`
  - `results/shadow/shadow_trade_events.csv`
  - `results/shadow/status.json`, `state.json`, `ws_health.json`, etc.

### “Latest run” discovery
- For BTC wrapper runs (timestamped): newest dir under `results/bt_spot_btc_usdc/`.
- PowerShell pattern:
  - `Get-ChildItem .\results\bt_spot_btc_usdc -Directory | Sort-Object Name -Descending | Select-Object -First 1`

---

## 5) Most likely backtest command templates

```powershell
# 1) BTC/USDC spot wrapper (long-only)
python .\scripts\bt_spot_btc_usdc.py --bt --csv .\Datasets\BTCUSDC\5m\BTCUSDC_5m_full.csv --symbol BTC/USDC --fee_maker 0.0 --fee_taker 0.0 --slip_bps_entry 2.0 --slip_bps_stop 6.0 --tp_bidask_half_spread_bps 1.0 --risk_per_trade 0.03 --start_equity 5000 --outdir .\results\bt_spot_btc_usdc\<run_name_or_timestamp>

# 2) ETH/USDC spot wrapper (long-only)
python .\scripts\bt_spot_eth_usdc.py --bt --csv .\Datasets\ETHUSDC\5m\ETHUSDC_5m_full.csv --symbol ETH/USDC --risk_per_trade 0.03 --start_equity 5000 --outdir .\results\bt_spot_eth_usdc\<run_name_or_timestamp>

# 3) SOL/USDC spot wrapper (long-only)
python .\scripts\bt_spot_sol_usdc.py --bt --csv .\Datasets\SOLUSDC\5m\SOLUSDC_5m_full.csv --symbol SOL/USDC --risk_per_trade 0.03 --start_equity 5000 --outdir .\results\bt_spot_sol_usdc\<run_name_or_timestamp>

# 4) Main engine directly (spot), with full controls
python .\scripts\solusdt_vwap_bot_spot.py --bt --csv .\Datasets\SOLUSDT\5m\SOLUSDT_5m_um.csv --outdir .\results\Backtest\<run_name> --equity 5000 --risk_per_trade 0.03 --slip_model fixed --slip_bps 0.5 --tp_bidask_half_spread_bps 0.5

# 5) Download Binance spot dataset (for backtests)
python -m scripts.dl_spot_binance --symbol BTCUSDT --timeframe 5m --start 2017-01-01 --out .\Datasets\BINANCE\BTCUSDT\5m\BTCUSDT_5m_full.csv
```

